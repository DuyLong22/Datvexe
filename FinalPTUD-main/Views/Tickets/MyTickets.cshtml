@model IEnumerable<BusTicketBooking.Models.Ticket>

@{
    ViewData["Title"] = "Vé của tôi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card shadow-sm mt-4">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0"><i class="bi bi-ticket-perforated-fill me-2"></i> Vé của tôi</h4>
    </div>
    <div class="card-body">
        @if (TempData["Message"] != null)
        {
            <div class="alert alert-success">@TempData["Message"]</div>
        }

        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Mã vé</th>
                    <th>Chuyến</th>
                    <th>Ghế</th>
                    <th>Ngày đặt</th>
                    <th>Ngày giờ khởi hành</th>
                    <th>Giá vé</th>
                    <th>Trạng thái</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var ticket in Model)
                {
                    <tr>
                        <td><strong>@ticket.Code</strong></td>
                        <td>
                            @ticket.Trip!.Route!.DepartureCity?.CityName →
                            @ticket.Trip!.Route!.DestinationCity?.CityName <br />
                            <small class="text-muted">@ticket.Trip!.BusName</small>
                        </td>
                        <td>@string.Join(", ", ticket.SeatNumber.Select(s => s.SeatNumber))</td>
                        <td>@ticket.BookingDate.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@ticket.Trip!.DepartureTime.ToString("dd/MM/yyyy HH:mm")</td>
                        <td><strong>@string.Format("{0:N0} đ", ticket.Price * ticket.SeatNumber.Count)</strong></td>

                        <td>
                            @if (ticket.Status == "Confirmed")
                            {
                                <span class="badge bg-success">Đã xác nhận</span>
                            }
                            else if (ticket.Status == "Pending")
                            {
                                <span class="badge bg-warning text-dark">Chờ thanh toán</span>
                            }
                            else if (ticket.Status == "Cancelled")
                            {
                                <span class="badge bg-danger">Đã hủy</span>
                            }
                        </td>
                        <td>
                            @if (ticket.Status == "Pending")
                            {
                                <form asp-controller="Tickets" asp-action="PayConfirm" method="post">
                                    <input type="hidden" name="ticketId" value="@ticket.TicketId" />
                                    <button type="submit" class="btn btn-sm btn-primary">
                                        <i class="bi bi-credit-card"></i> Thanh toán
                                    </button>
                                </form>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
